"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.placeMutants = exports.MUTANT_PLACERS = void 0;
const tslib_1 = require("tslib");
const path_1 = tslib_1.__importDefault(require("path"));
tslib_1.__exportStar(require("./mutant-placer"), exports);
const statement_mutant_placer_1 = require("./statement-mutant-placer");
const expression_mutant_placer_1 = require("./expression-mutant-placer");
const switch_case_mutant_placer_1 = require("./switch-case-mutant-placer");
exports.MUTANT_PLACERS = Object.freeze([expression_mutant_placer_1.expressionMutantPlacer, statement_mutant_placer_1.statementMutantPlacer, switch_case_mutant_placer_1.switchCaseMutantPlacer]);
/**
 * Represents a mutant placer, tries to place a mutant in the AST with corresponding mutation switch and mutant covering expression
 * @see https://github.com/stryker-mutator/stryker/issues/1514
 * @param node The ast node to try and replace with a mutated
 * @param mutants The mutants to place in the AST node
 * @param fileName The name of the file where the mutants are placed
 * @param mutantPlacers The mutant placers to use (for unit testing purposes)
 */
function placeMutants(node, mutants, fileName, mutantPlacers = exports.MUTANT_PLACERS) {
    var _a, _b;
    if (mutants.length) {
        for (const placer of mutantPlacers) {
            try {
                if (placer(node, mutants)) {
                    return true;
                }
            }
            catch (error) {
                const location = `${path_1.default.relative(process.cwd(), fileName)}:${(_a = node.node.loc) === null || _a === void 0 ? void 0 : _a.start.line}:${(_b = node.node.loc) === null || _b === void 0 ? void 0 : _b.start.column}`;
                const message = `${placer.name} could not place mutants with type(s): "${mutants.map((mutant) => mutant.mutatorName).join(', ')}"`;
                throw node.buildCodeFrameError(`${location} ${message}. Either remove this file from the list of files to be mutated, or ignore the mutators. Please report this issue at https://github.com/stryker-mutator/stryker/issues/new?assignees=&labels=%F0%9F%90%9B+Bug&template=bug_report.md&title=${encodeURIComponent(message)}.`);
            }
        }
    }
    return false;
}
exports.placeMutants = placeMutants;
//# sourceMappingURL=index.js.map